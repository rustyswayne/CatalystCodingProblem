var Peeps=function(){function e(){$(document).ready(function(){Peeps.Dashboards.init(),Peeps.GitHub.init()})}function t(){return!1}function n(e,t){try{var n=_.find(u,function(t){return t.event===e});if(void 0!==n&&null!==n)void 0!==t&&"function"==typeof t&&n.callbacks.push(t);else{var a=[];void 0!==t&&"function"==typeof t&&a.push(t),u.push({event:e,callbacks:a})}}catch(e){console.info(e)}}function a(e,t){var n=_.find(u,function(t){return t.event===e});void 0!==n&&null!==n&&_.each(n.callbacks,function(n){try{n(e,t)}catch(n){MUI.Logger.captureError(n,{extra:{eventName:e,args:t}})}})}function r(e){var t={};return function(n,a){return t[n]||(t[n]=$.Deferred(function(t){e(t,n)}).promise()),t[n].done(a)}}function i(e,t){var n=_.find(e,function(e){return e.alias===t});return void 0===n?"":n.name}function o(e){d.events&&_.each(e,function(e){MUI.on(e.name,function(t,n){console.log(e),console.log(void 0===n?"No args":n)})})}function s(e){d.console&&console.log(e)}function c(e){return $(e).length>0}var d={events:!1,console:!0},u=[];return{Settings:{Notifications:{},Endpoints:{}},init:e,willWork:c,hasLogger:t,createCache:r,on:n,emit:a,getEventNameByAlias:i,debugConsoleEvents:o,debugConsole:s}}();Peeps.Settings={localCacheDuration:10,spinnerSvg:"/Media/Placeholders/balls.svg",enableApiDelays:!0,apiRoutes:[{id:"countrymetrics",value:"/dashboard/countriessnapshot",title:"Querying Country Metrics...",notes:"Country filter queries not implemented.",delay:750},{id:"peopleprops",value:"/dashboard/peoplepropertystats",title:"Evaluating Profiles...",notes:"Property filter queries not implemented.",delay:1250},{id:"randomwatched",value:"/dashboard/randomwatched",title:"Selecting random...",notes:"Randomly selected from watched",delay:0}]},Peeps.Dashboards={init:function(){var e=$("div[data-dashboard]");e.length&&_.each(e,function(e){Peeps.Dashboards.binder.invoke(e)})},binder:{invoke:function(e){var t=$(e).data("dashboard"),n=Peeps.Dashboards.spinner.makeId();Peeps.Dashboards.spinner.appendSpinner(e,n);var a={dashboard:e,args:{},skip:!0};if("donothing"!==t){var r=_.find(Peeps.Settings.apiRoutes,function(e){if(e.id===t)return e});void 0!==r&&(a.args=r,a.skip=!1,Peeps.Dashboards.binder.query(a))}},query:function(e){if(void 0===e)throw new Error("Routing params have not been defined.");var t=e.dashboard;$(t).find(".chart-title").text(e.args.title);var n=void 0===e.args.delay?0:e.args.delay;Peeps.Settings.enableApiDelays||(n=0),n>0&&$(t).find(".chart-notes").text("FAKE DELAY of ("+e.args.delay+" ms) added for demo!"),$(t).find(""),$.ajax({url:e.args.value,dataType:"html"}).done(function(e){setTimeout(function(){$(t).parent().html(e),$(t).find(".chart-notes").text("Note:")},n)}).fail(function(){console.log("Failure not implemented.")})}},spinner:{activeIds:[],appendSpinner:function(e,t){Peeps.Dashboards.spinner.activeIds.push(t);var n=Peeps.Dashboards.spinner.build(t);$(e).find(".chart-stage").html(n)},build:function(e){return $('<div class="dashboard-spinner"><img src="'+Peeps.Settings.spinnerSvg+'" id="'+e+'" alt="Loading..." /></div>')},makeId:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<10;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}}},Peeps.Storage={Cache:{setItem:function(e,t){var n=new Date;t.peeps={},t.peeps.cacheStamp=n,t.peeps.expired=!1,localStorage&&localStorage.setItem("__peeps-"+e,JSON.stringify(t))},getItem:function(e){var t=new Date;if(localStorage){var n=JSON.parse(localStorage.getItem("__peeps-"+e));if(!n)return null;var a=new Date(n.peeps.cacheStamp),r=t-a;if(!(Math.round(r%864e5%36e5/6e4)>Peeps.Settings.localCacheDuration))return n;n.peeps.expired=!0}}}},Peeps.GitHub={feedCount:20,init:function(){Peeps.willWork(".github-activity")&&Peeps.GitHub.getCommitFeeds()},getCommitFeeds:function(){$(".github-activity").each(function(){var e=$(this).attr("data-owner"),t=$(this).attr("data-repo"),n=e+"-"+t;Peeps.GitHub.getFeed($(this),UD.GitHub.getCommitApiUrl(e,t),n)})},getFeed:function(e,t,n){var a=Peeps.Storage.Cache.getItem(n);null==a||1==a.expired?$.ajax({url:t,dataType:"jsonp",success:function(t){null!=t?(Peeps.Storage.Cache.setItem(n,t),Peeps.GitHub.generateList(e,t)):null!=a&&(Peeps.debugConsole("using expired."),Peeps.GitHub.generateList(e,a))}}):Peeps.GitHub.generateList(e,a)},createAvatar:function(e){var t=document.createElement("img");return $(t).attr("src",e).addClass("avatar"),t},createSpan:function(e,t){var n=document.createElement("span");return $(n).addClass(t).text(e),n},createAnchor:function(e,t,n){var a=document.createElement("a");return $(a).attr("href",e).addClass(n).text(t),a},getCommitApiUrl:function(e,t){return"https://api.github.com/repos/"+e+"/"+t+"/commits?callback=?"},generateList:function(e,t){if(t.data.length>0){var n=document.createElement("ul");$.each(t.data.slice(0,UD.GitHub.feedCount),function(e,t){var a=document.createElement("li"),r="";null!==t.author&&(r=t.author.avatar_url,$(a).append(Peeps.GitHub.createAvatar(r)));var i=document.createElement("div");$(i).addClass("commit"),null!==t.author&&$(i).append(Peeps.GitHub.createAnchor(t.author.html_url,t.author.login,"author"));var o=document.createElement("i");$(o).addClass("octicon").addClass("octicon-git-commit"),$(i).append(o),console.info(t),null!==t.parents?$(i).append(Peeps.GitHub.createAnchor(t.parents[0].html_url,t.commit.message,"message")):$(i).append(Peeps.GitHub.createSpan(t.commit.message,"message")),$(a).append(i),$(n).append(a)}),$(e).append(n),$(e).children(".loading").removeClass("expanded")}}},Peeps.init();